@model Tuple<FrxAccount, List<FrxAccount>, AccountInfo>
@{
    var actionName = ViewContext.RouteData.Values["action"].ToString();
    var controllerName = ViewContext.RouteData.Values["controller"].ToString();
    var areaName = ViewContext.RouteData.Values["area"].ToString();
    ViewData["action"] = actionName;
    ViewData["controller"] = controllerName;
    ViewData["area"] = areaName;
    ViewData["Title"] = controllerName;
    string path = "/" + areaName + "/" + controllerName;
}
<section class="content-header">
    <h1>
        @ViewData["action"]
        <small>@ViewData["controller"]</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> @ViewData["area"]</a></li>
        <li class="active"> @ViewData["controller"]</li>
    </ol>
</section>
<section class="content">
    <div class="row">
        <div class="col-md-12">
            <div class="box box-info">
                <div class="box-header with-border">
                    <h3 class="box-title">Info</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <div class="btn-group">
                            <button type="button" class="btn btn-box-tool dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-refresh"></i>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <li id="analyze_net"><a href="#"><i class="fa fa-circle-o" style="color:skyblue"></i>net</a></li>
                                <li id="analyze_lots"><a href="#"><i class="fa fa-circle-o" style="color:skyblue"></i>lots</a></li>
                                <li id="analyze_gain"><a href="#"><i class="fa fa-circle-o" style="color:skyblue"></i>gain</a></li>
                            </ul>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-box-tool dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-wrench"></i>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                @foreach (var f in Model.Item2)
            {
                    <li><a href="@Url.Action("Index","FrxHistory",new {  acId=f.AccountId })"><i class="fa fa-circle-o" style="color:skyblue"></i>@f.AccountNumber</a></li>
}
                            </ul>
                        </div>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                    </div>
                </div>
                <div class="box-body">
                    <div id="dataAnalyzeChart" style="height:300px;width:100%"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <div class="box box-info">
                <div class="box-header with-border">
                    <h3 class="box-title">Histories</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <div class="btn-group">
                            <button type="button" class="btn btn-box-tool dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-wrench"></i>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                @foreach (var f in Model.Item2)
                                {
                                    <li><a href="@Url.Action("Index","FrxHistory",new {  acId=f.AccountId })"><i class="fa fa-circle-o" style="color:skyblue"></i>@f.AccountNumber</a></li>
                                }
                            </ul>
                        </div>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                    </div>
                </div>
                <div class="box-body table-responsive">
                </div>
            </div>
        </div>
    </div>
</section>
@section Scripts{
    <script src="~/lib/echart/echarts.js"></script>
    <script>
        var myChart = echarts.init(document.getElementById('dataAnalyzeChart'));
        var xdata = [];
        var mdata = [];
        var ydata = [];
        option = {
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross'
                }
            },
            xAxis: [{
                    type: 'category',
                    axisTick: {
                        alignWithLabel: true
                    },
                    data: []
                }],
            yAxis: [{
                type:'value',
            }],
            dataZoom: [
                {
                    id: 'dataZoomX',
                    type: 'inside',
                    xAxisIndex: [0],
                    filterMode: 'filter'
                }
            ],
            series: [
                {
                    name: 'val',
                    type: 'bar',
                    label: {
                            show: true,
                            position: 'insideTop',
                            formatter: function (p) {
                                return p.value > 0 ? (p.value) : '';
                            }
                    },
                    data: []
                }
            ]
        };
        myChart.setOption(option, true);
        $.ajax({
            type: "post",
            async: true,
            url: "@Url.Action("GetHistory", "FrxAnalyze", new { acId = Model.Item1.AccountId })",
            data: {},
            dataType: "json",
            success: function (result) {
                if (result) {
                    for (var i = 0; i < result.xDatas.length; i++) {
                        xdata.push(result.xDatas[i].xName);
                        mdata.push(result.mDatas[i]);
                        ydata.push(result.mDatas[i].netProfit);
                    }
                    myChart.setOption({
                        xAxis: {
                            data: xdata
                        },
                        series: [
                            {
                                name: 'val',
                                data: ydata
                            },
                        ]
                    });
                }
            },
            error: function (errorMsg) {
                alert("图表请求数据失败!");
                myChart.hideLoading();
            }
        });
        $("#analyze_net").click(function () {
            var temp = [];
            for (var i = 0; i < mdata.length; i++) {
                temp.push(mdata[i].netProfit);
            }
            myChart.setOption({
                series: [
                    {
                        name: 'val',
                        data: temp
                    }
                ]
            });
        });
        $("#analyze_lots").click(function () {
            var temp = [];
            for (var i = 0; i < mdata.length; i++) {
                temp.push(mdata[i].lots);
            }
            myChart.setOption({
                series: [
                    {
                        name: 'val',
                        data: temp
                    }
                ]
            });
        });
        $("#analyze_gain").click(function () {
            var temp = [];
            for (var i = 0; i < mdata.length; i++) {
                temp.push(mdata[i].gain);
            }
            myChart.setOption({
                series: [
                    {
                        name: 'val',
                        data: temp
                    }
                ]
            });
        });
    </script>
}
